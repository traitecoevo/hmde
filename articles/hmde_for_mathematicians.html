<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hmde for Mathematicians • hmde</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="hmde for Mathematicians">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hmde</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hmde.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Case Studies</h6></li>
    <li><a class="dropdown-item" href="../articles/constant-growth.html">Constant growth model</a></li>
    <li><a class="dropdown-item" href="../articles/von-bertalanffy.html">von Bertalanffy model</a></li>
    <li><a class="dropdown-item" href="../articles/canham.html">Canham model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/traitecoevo/austraits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>hmde for Mathematicians</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/traitecoevo/austraits/blob/master/vignettes/hmde_for_mathematicians.Rmd" class="external-link"><code>vignettes/hmde_for_mathematicians.Rmd</code></a></small>
      <div class="d-none name"><code>hmde_for_mathematicians.Rmd</code></div>
    </div>

    
    
<p>This vignette is intended for a statistical/mathematical audience who
are interested in Bayesian inverse problems. For biologists looking for
an applications-based walkthrough the other vignettes in this package –
<code>hmde</code>, <code>constant-growth</code>,
<code>von-bertalanffy</code>, and <code>canham</code> – are less
theoretical.</p>
<div class="section level2">
<h2 id="getting-started-with-hmde">Getting started with {hmde}<a class="anchor" aria-label="anchor" href="#getting-started-with-hmde"></a>
</h2>
<p>‘hmde’ is under active development, you can install the development
version of ‘hmde’ from <a href="https://github.com/" class="external-link">GitHub</a>
with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"traitecoevo/hmde"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://traitecoevo.github.io/hmde/">hmde</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-theory">The Theory<a class="anchor" aria-label="anchor" href="#the-theory"></a>
</h2>
<p>The underlying method that the hmde package implements leverages the
longitudinal structure of repeat measurement data to estimate parameters
for an underlying differential equation, as first demonstrated in . This
method is an example of a Bayesian inverse method for differential
equation estimation: we are attempting to estimate the parameters of a
chosen DE based on observations of the resulting process. We assume that
the data consists of a finite number of discrete (likely sparse)
observations with measurement error at the individual level, and have a
set number of possible differential equations ready to be fit to
data.</p>
<div class="section level3">
<h3 id="the-maths">The Maths<a class="anchor" aria-label="anchor" href="#the-maths"></a>
</h3>
<p>In a general setting, we are interested in some quantity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y(t)</annotation></semantics></math>
that changes over time (approximately) according to a chosen DE
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>.
We have some finite finite number measurements at times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>j</mi></msub><annotation encoding="application/x-tex">t_j</annotation></semantics></math>,
and believe that the underlying true behaviour is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mo>∫</mo><msub><mi>t</mi><mi>j</mi></msub><msub><mi>t</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub></msubsup><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>𝛉</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>d</mi><mi>t</mi><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
Y(t_{j+1}) = Y(t_j) + \int_{t_j}^{t_{j+1}} f(Y(t), \boldsymbol{\theta})\,dt\qquad (1)
</annotation></semantics></math> for unseen parameter vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
that we wish to estimate. We also have an initial condition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mn>0</mn></msub><mo>=</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_0 = Y(t_0)</annotation></semantics></math>.</p>
<p>We have three in-built growth functions in <code>hmde</code>.</p>
<ul>
<li><p>Constant:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>=</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">f = \beta</annotation></semantics></math>
chosen as when you only have two observations the average growth rate is
the best you can do. Furthermore, the results from the constant model
align with a linear mixed effects model for size with individual
parameter. The constant model is size-independent. As all numerical
methods are equivalent and the same as the analytic solution given the
initial condition, we use the Euler method for the constant
model.</p></li>
<li><p>von Bertalanffy:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>=</mo><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>−</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f = \beta (Y_{max} - Y(t))\qquad\qquad(2)</annotation></semantics></math>
which has a history of use in biology for species that grow to some
maximum size, and represents a simple size-dependent linear function. If
a power law model is desired, log-transforming observations and then
back-transforming by exponentiation gives such a function. Equation (2)
is implemented with the analytic solution rather than a numerical
method, as it is a known nightmare example for numerical stability due
to the negative coefficient on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y(t)</annotation></semantics></math>.</p></li>
<li><p>Canham:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>=</mo><msub><mi>f</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>exp</mo><mo minsize="3.0" maxsize="3.0" stretchy="false" form="prefix">(</mo><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo minsize="2.4" maxsize="2.4" stretchy="false" form="prefix">(</mo><mfrac><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msub><mi>Y</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>k</mi></mfrac><msup><mo minsize="2.4" maxsize="2.4" stretchy="false" form="postfix">)</mo><mn>2</mn></msup><mo minsize="3.0" maxsize="3.0" stretchy="false" form="postfix">)</mo><mo>,</mo><mspace width="2.0em"></mspace><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
f = f_{max} \exp\Bigg(-\frac{1}{2}\bigg(\frac{\log(Y(t)/Y_{max})}{k} \bigg)^2 \Bigg),\qquad\qquad(3)
</annotation></semantics></math> which is considered a reasonable
approximation of long term growth behaviour for some tree species as
shown in and [Chapter 2]. Equation (3) is extremely non-linear and does
not have an analytic solution, forcing the use of numerical methods in
order to estimate the growth increments in Equation (1).</p></li>
<li><p>Affine:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>−</mo><msub><mi>β</mi><mn>1</mn></msub><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f = \beta_0 - \beta_1 Y(t)</annotation></semantics></math>
which is only included for demonstration purposes of where numerical
methods can go wrong as it is a re-parameterisation of the von
Bertalanffy model.</p></li>
</ul>
<p>Choice of appropriate function is an exercise for the user and
depends on the available data. Aside from the affine model all have
versions that work with both a single individual, and multiple
individuals. We provide example data intended for use with each of the
primary models: - <code>Trout_Size_Data</code> for the constant model, -
<code>Lizard_Size_Data</code> for the von Bertalanffy model, -
<code>Tree_Size_Data</code> for the Canham model.</p>
</div>
<div class="section level3">
<h3 id="the-stats">The Stats<a class="anchor" aria-label="anchor" href="#the-stats"></a>
</h3>
<p>We assume that we do not have access to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
or the true values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
over time. Instead we have observations with measurement error,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mtext mathvariant="normal">error</mtext><mo>,</mo></mrow><annotation encoding="application/x-tex">
y_j = Y(t_j) + \text{error},
</annotation></semantics></math> and estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝛉</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\theta}}</annotation></semantics></math>.</p>
<p>We use a hierarchical structure to encode different levels of
relationships within the data. At the bottom of the hierarchy is the
measurement level
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>∼</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>Y</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>σ</mi><mi>e</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
y_j \sim \mathcal{N}(\hat{Y}(t_j), \sigma_e),
</annotation></semantics></math> where we assume normally distributed
error. This may not always be true, but indicated that symmetric error
centred at 0 may be enough for reasonable results. The longitudinal
structure in Equation (1) serves as the next level, connecting estimated
sizes over time based on the chosen function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
and estimated parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝛉</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\theta}}</annotation></semantics></math>,
which operates at the level of the individual.</p>
<p>If the data has multiple individuals we add additional layers that
act as hyper-parameters on the distributions of elements of each
individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>’s
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>𝛉</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><annotation encoding="application/x-tex">\hat{\boldsymbol{\theta}}_i</annotation></semantics></math>.
We build these to be independent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ki}</annotation></semantics></math>s,
with log-mean and log-standard deviation parameters
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>∼</mo><mo>log</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\theta_k \sim \log\mathcal{N}(\mu_k, \sigma_k),
</annotation></semantics></math> and typically use the following priors:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>k</mi></msub><mo>∼</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mn>0</mn><mo>&lt;</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>∼</mo><mi>C</mi><mi>a</mi><mi>u</mi><mi>c</mi><mi>h</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mu_k \sim\mathcal{N}(0,2), \quad 0 &lt; \sigma_k\sim Cauchy(0, 2).
</annotation></semantics></math> For details on the prior distributions
see the vignette for a specific model or check the Stan file. To see the
default values run <code>hmde_model</code> on the model name as a string
and look at the <code>prior_pars</code> argument for the parameter
name:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hmde_model.html">hmde_model</a></span><span class="op">(</span><span class="st">"canham_multi_ind"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_obs</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_ind</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $y_obs</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $obs_index</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $time</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ind_id</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_pop_log_max_growth_mean</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_pop_log_max_growth_sd</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_pop_log_size_at_max_growth_mean</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_pop_log_size_at_max_growth_sd</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_pop_log_k_mean</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_pop_log_k_sd</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $prior_pars_global_error_sigma</span></span>
<span><span class="co">#&gt; [1] 0 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model</span></span>
<span><span class="co">#&gt; [1] "canham_multi_ind"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "hmde_object"</span></span></code></pre></div>
<p>The error parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>e</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\sigma_e &gt;0</annotation></semantics></math>
is assumed to operate at a global level independent of individual and
typically has a Cauchy prior with location 0, spread parameter 2.</p>
<p>Estimation is done using MCMC through Stan.</p>
</div>
<div class="section level3">
<h3 id="integration-of-time-series">Integration of time series<a class="anchor" aria-label="anchor" href="#integration-of-time-series"></a>
</h3>
<p>Numerical methods are required for the Canham model as it has no
analytic solution, and the inbuilt Stan Runge-Kutta 4-5 solver is
used.</p>
<p>For the von Bertalanffy model an analytic solution is used in order
to avoid numerical problems. For the constant model all numerical
methods are the same and give the same result as the analytic solution
so Euler is used.</p>
</div>
</div>
<div class="section level2">
<h2 id="demonstration-canham-growth---multiple-individuals">Demonstration: Canham Growth - Multiple Individuals<a class="anchor" aria-label="anchor" href="#demonstration-canham-growth---multiple-individuals"></a>
</h2>
<p>The provided tree data for 50 individuals takes a few hours to run.
As such, the following block does not run by default, and instead we
leverage the provided estimates data file: <code>Tree_Size_Ests</code>.
The estimates are posterior mean, median, and 95% central credible
intervals for parameters, and mean posterior estimates of sizes over
time based on the longitudinal model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build fit and extract estimates</span></span>
<span><span class="va">canham_multi_ind_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hmde_model.html">hmde_model</a></span><span class="op">(</span><span class="st">"canham_multi_ind"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/hmde_assign_data.html">hmde_assign_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Tree_Size_Data</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/hmde_run.html">hmde_run</a></span><span class="op">(</span>chains <span class="op">=</span> <span class="fl">1</span>, cores <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Tree_Size_Ests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hmde_extract_estimates.html">hmde_extract_estimates</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">canham_multi_ind_fit</span>,</span>
<span>                                 input_measurement_data <span class="op">=</span> <span class="va">Tree_Size_Data</span><span class="op">)</span></span></code></pre></div>
<p>The following code produces plots of the Canham function for each
individual between the first and last estimated size. The purpose of the
plot is to look at how different individual growth functions behave.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Tree_Size_Ests</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  Length Class  Mode     </span></span>
<span><span class="co">#&gt; model             1     -none- character</span></span>
<span><span class="co">#&gt; measurement_data  5     tbl_df list     </span></span>
<span><span class="co">#&gt; individual_data  13     tbl_df list     </span></span>
<span><span class="co">#&gt; error_data        5     tbl_df list     </span></span>
<span><span class="co">#&gt; population_data   5     tbl_df list</span></span>
<span></span>
<span><span class="co"># Plot fitted growth function pieces</span></span>
<span><span class="va">plot_par_individual_data</span> <span class="op">&lt;-</span> <span class="va">Tree_Size_Ests</span><span class="op">$</span><span class="va">individual_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="co">#Pull out estimates only</span></span>
<span><span class="fu"><a href="../reference/hmde_plot_de_pieces.html">hmde_plot_de_pieces</a></span><span class="op">(</span><span class="va">Tree_Size_Ests</span><span class="op">)</span></span></code></pre></div>
<p><img src="hmde_for_mathematicians_files/figure-html/unnamed-chunk-6-1.png" width="700">
Each line represents 25 years of growth for the specific individual.
Lines that sit lower on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>-axis
are shorter horizontally because they are traversed more slowly, as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
is the rate of change in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p>
<p>To understand the error model, the following code plots a number of
individual sizes over time, then super-imposes those growth curves in
black on the individual growth function plots. To view a specific
individual, use the <code>ind_id</code> value to select them.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Plots of size over time for a sample of 5 individuals</span></span>
<span><span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Tree_Size_Ests</span><span class="op">$</span><span class="va">individual_data</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">Tree_Size_Ests</span><span class="op">$</span><span class="va">measurement_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ind_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_ids</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ind_size_lims</span> <span class="op">&lt;-</span> <span class="va">Tree_Size_Ests</span><span class="op">$</span><span class="va">measurement_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ind_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_ids</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ind_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>y_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">y_hat</span><span class="op">)</span>,</span>
<span>         y_final <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">y_hat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">ind_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y<span class="op">=</span><span class="va">y_obs</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ind_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y<span class="op">=</span><span class="va">y_obs</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ind_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y<span class="op">=</span><span class="va">y_hat</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ind_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y<span class="op">=</span><span class="va">y_hat</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ind_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            linetype <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Time (years)"</span>, y<span class="op">=</span><span class="st">"DBH (cm)"</span>, colour<span class="op">=</span><span class="st">"Ind. ID"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="hmde_for_mathematicians_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Load DE for Canham</span></span>
<span><span class="va">DE_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/hmde_model_des.html">hmde_model_des</a></span><span class="op">(</span><span class="st">"canham_multi_ind"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Produce plot with focus inds</span></span>
<span><span class="va">function_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hmde_plot_de_pieces.html">hmde_plot_de_pieces</a></span><span class="op">(</span><span class="va">Tree_Size_Ests</span>,</span>
<span>                    alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> </span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">args_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pars<span class="op">=</span><span class="va">Tree_Size_Ests</span><span class="op">$</span><span class="va">individual_data</span><span class="op">[</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">function_plot</span> <span class="op">&lt;-</span> <span class="va">function_plot</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">DE_function</span>, args<span class="op">=</span><span class="va">args_list</span>,</span>
<span>                    colour<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ind_size_lims</span><span class="op">$</span><span class="va">y_0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">ind_size_lims</span><span class="op">$</span><span class="va">y_final</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">function_plot</span></span></code></pre></div>
<p><img src="hmde_for_mathematicians_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Falster, Tess O’Brien, David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
